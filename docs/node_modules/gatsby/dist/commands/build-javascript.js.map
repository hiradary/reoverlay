{"version":3,"sources":["../../src/commands/build-javascript.ts"],"names":["buildProductionBundle","program","parentSpan","directory","compilerConfig","Promise","resolve","reject","run","err","stats","hasErrors","flattenStatsErrors","compilation","errors","children","child","getStats"],"mappings":";;;;;;;AACA;;AACA;;AAEA;;AAIA;;AAEO,MAAMA,qBAAqB,GAAG,OACnCC,OADmC,EAEnCC,UAFmC,KAGR;AAC3B,QAAM;AAAEC,IAAAA;AAAF,MAAgBF,OAAtB;AAEA,QAAMG,cAAc,GAAG,MAAM,uBAC3BH,OAD2B,EAE3BE,SAF2B,EAG1B,kBAH0B,EAI3B,IAJ2B,EAK3B;AAAED,IAAAA;AAAF,GAL2B,CAA7B;AAQA,SAAO,IAAIG,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,0BAAQH,cAAR,EAAwBI,GAAxB,CAA4B,CAACC,GAAD,EAAMC,KAAN,KAAgB;AAC1C,UAAID,GAAJ,EAAS;AACP,eAAOF,MAAM,CAACE,GAAD,CAAb;AACD;;AAED,oDAAsBC,KAAtB;;AAEA,UAAIA,KAAK,CAACC,SAAN,EAAJ,EAAuB;AACrB,cAAMC,kBAAkB,GAAIF,KAAD,IAAmC,CAC5D,GAAGA,KAAK,CAACG,WAAN,CAAkBC,MADuC,EAE5D,GAAG,sBAAQJ,KAAK,CAACG,WAAN,CAAkBE,QAA1B,EAAoCC,KAAK,IAC1CJ,kBAAkB,CAACI,KAAK,CAACC,QAAN,EAAD,CADjB,CAFyD,CAA9D;;AAMA,eAAOV,MAAM,CAACK,kBAAkB,CAACF,KAAD,CAAnB,CAAb;AACD;;AAED,aAAOJ,OAAO,CAACI,KAAD,CAAd;AACD,KAlBD;AAmBD,GApBM,CAAP;AAqBD,CAnCM","sourcesContent":["import { Span } from \"opentracing\"\nimport webpack from \"webpack\"\nimport flatMap from \"lodash/flatMap\"\n\nimport webpackConfig from \"../utils/webpack.config\"\n\nimport { IProgram } from \"./types\"\n\nimport { reportWebpackWarnings } from \"../utils/webpack-error-utils\"\n\nexport const buildProductionBundle = async (\n  program: IProgram,\n  parentSpan: Span\n): Promise<webpack.Stats> => {\n  const { directory } = program\n\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `build-javascript`,\n    null,\n    { parentSpan }\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((err, stats) => {\n      if (err) {\n        return reject(err)\n      }\n\n      reportWebpackWarnings(stats)\n\n      if (stats.hasErrors()) {\n        const flattenStatsErrors = (stats: webpack.Stats): Error[] => [\n          ...stats.compilation.errors,\n          ...flatMap(stats.compilation.children, child =>\n            flattenStatsErrors(child.getStats())\n          ),\n        ]\n        return reject(flattenStatsErrors(stats))\n      }\n\n      return resolve(stats)\n    })\n  })\n}\n"],"file":"build-javascript.js"}