{"version":3,"sources":["../../src/services/run-page-queries.ts"],"names":["runPageQueries","parentSpan","queryIds","store","program","graphqlRunner","reporter","panic","pageQueryIds","state","getState","pageQueryIdsCount","filter","id","pages","has","length","activity","createProgress","start","graphqlTracing","done"],"mappings":";;;;;;;AAAA;;AAEA;;AAEO,eAAeA,cAAf,CAA8B;AACnCC,EAAAA,UADmC;AAEnCC,EAAAA,QAFmC;AAGnCC,EAAAA,KAHmC;AAInCC,EAAAA,OAJmC;AAKnCC,EAAAA;AALmC,CAA9B,EAMmC;AACxC,MAAI,CAACF,KAAL,EAAY;AACVG,sBAASC,KAAT,CAAgB,0CAAhB;AACD;;AACD,MAAI,CAACL,QAAL,EAAe;AACb;AACD;;AACD,QAAM;AAAEM,IAAAA;AAAF,MAAmBN,QAAzB;AACA,QAAMO,KAAK,GAAGN,KAAK,CAACO,QAAN,EAAd;AACA,QAAMC,iBAAiB,GAAGH,YAAY,CAACI,MAAb,CAAoBC,EAAE,IAAIJ,KAAK,CAACK,KAAN,CAAYC,GAAZ,CAAgBF,EAAhB,CAA1B,EACvBG,MADH;;AAGA,MAAI,CAACL,iBAAL,EAAwB;AACtB;AACD;;AAED,QAAMM,QAAQ,GAAGX,kBAASY,cAAT,CACd,kBADc,EAEfP,iBAFe,EAGf,CAHe,EAIf;AACEE,IAAAA,EAAE,EAAG,oBADP;AAEEZ,IAAAA;AAFF,GAJe,CAAjB;;AAUAgB,EAAAA,QAAQ,CAACE,KAAT;AACA,QAAM,+BAAmBX,YAAnB,EAAiC;AACrCC,IAAAA,KADqC;AAErCQ,IAAAA,QAFqC;AAGrCZ,IAAAA,aAHqC;AAIrCe,IAAAA,cAAc,EAAEhB,OAAF,aAAEA,OAAF,uBAAEA,OAAO,CAAEgB;AAJY,GAAjC,CAAN;AAOAH,EAAAA,QAAQ,CAACI,IAAT;AACD","sourcesContent":["import { processPageQueries } from \"../query\"\nimport { IBuildContext } from \"./\"\nimport reporter from \"gatsby-cli/lib/reporter\"\n\nexport async function runPageQueries({\n  parentSpan,\n  queryIds,\n  store,\n  program,\n  graphqlRunner,\n}: Partial<IBuildContext>): Promise<void> {\n  if (!store) {\n    reporter.panic(`Cannot run service without a redux store`)\n  }\n  if (!queryIds) {\n    return\n  }\n  const { pageQueryIds } = queryIds\n  const state = store.getState()\n  const pageQueryIdsCount = pageQueryIds.filter(id => state.pages.has(id))\n    .length\n\n  if (!pageQueryIdsCount) {\n    return\n  }\n\n  const activity = reporter.createProgress(\n    `run page queries`,\n    pageQueryIdsCount,\n    0,\n    {\n      id: `page-query-running`,\n      parentSpan,\n    }\n  )\n\n  activity.start()\n  await processPageQueries(pageQueryIds, {\n    state,\n    activity,\n    graphqlRunner,\n    graphqlTracing: program?.graphqlTracing,\n  })\n\n  activity.done()\n}\n"],"file":"run-page-queries.js"}