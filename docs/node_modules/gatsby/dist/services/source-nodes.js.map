{"version":3,"sources":["../../src/services/source-nodes.ts"],"names":["sourceNodes","parentSpan","webhookBody","store","reporter","panic","activity","activityTimer","start","span","verbose","getState","nodes","size","nodesByType","entries","map","type","join","end"],"mappings":";;;;;;;AACA;;AACA;;AACA;AACA;AAEO,eAAeA,WAAf,CAA2B;AAChCC,EAAAA,UADgC;AAEhCC,EAAAA,WAFgC;AAGhCC,EAAAA;AAHgC,CAA3B,EAImC;AACxC,MAAI,CAACA,KAAL,EAAY;AACVC,sBAASC,KAAT,CAAgB,gBAAhB;AACD;;AACD,QAAMC,QAAQ,GAAGF,kBAASG,aAAT,CAAwB,4BAAxB,EAAqD;AACpEN,IAAAA;AADoE,GAArD,CAAjB;;AAGAK,EAAAA,QAAQ,CAACE,KAAT,GAPwC,CAQxC;;AACA,QAAM,0BAA+B;AACnCP,IAAAA,UAAU,EAAEK,QAAQ,CAACG,IADc;AAEnC;AACAP,IAAAA;AAHmC,GAA/B,CAAN;;AAMAE,oBAASM,OAAT,CACG,YAAWP,KAAK,CAACQ,QAAN,GAAiBC,KAAjB,CAAuBC,IAAK,eACtCV,KAAK,CAACQ,QAAN,GAAiBG,WAAjB,CAA6BD,IAC9B,YAAW,CAAC,GAAGV,KAAK,CAACQ,QAAN,GAAiBG,WAAjB,CAA6BC,OAA7B,EAAJ,EACTC,GADS,CACL,CAAC,CAACC,IAAD,EAAOL,KAAP,CAAD,KAAmBK,IAAI,GAAI,GAAR,GAAaL,KAAK,CAACC,IADjC,EAETK,IAFS,CAEH,IAFG,CAEE,GALhB,EAfwC,CAuBxC;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAEAZ,EAAAA,QAAQ,CAACa,GAAT,GA7CwC,CA8CxC;AACA;AACA;AACA;AACD","sourcesContent":["import { IBuildContext } from \"./\"\nimport sourceNodesAndRemoveStaleNodes from \"../utils/source-nodes\"\nimport reporter from \"gatsby-cli/lib/reporter\"\n// import { findChangedPages } from \"../utils/check-for-changed-pages\"\n// import { IGatsbyPage } from \"../redux/types\"\n\nexport async function sourceNodes({\n  parentSpan,\n  webhookBody,\n  store,\n}: Partial<IBuildContext>): Promise<void> {\n  if (!store) {\n    reporter.panic(`No redux store`)\n  }\n  const activity = reporter.activityTimer(`source and transform nodes`, {\n    parentSpan,\n  })\n  activity.start()\n  // const currentPages = new Map<string, IGatsbyPage>(store.getState().pages)\n  await sourceNodesAndRemoveStaleNodes({\n    parentSpan: activity.span,\n    // deferNodeMutation: !!(webhookBody && Object.keys(webhookBody).length), // Coming soon\n    webhookBody,\n  })\n\n  reporter.verbose(\n    `Now have ${store.getState().nodes.size} nodes with ${\n      store.getState().nodesByType.size\n    } types: [${[...store.getState().nodesByType.entries()]\n      .map(([type, nodes]) => type + `:` + nodes.size)\n      .join(`, `)}]`\n  )\n\n  // reporter.info(`Checking for deleted pages`)\n\n  // Add this back when we enable page creation outside of onCreatePages\n  // const tim = reporter.activityTimer(`Checking for changed pages`)\n  // tim.start()\n\n  // const { changedPages, deletedPages } = findChangedPages(\n  //   currentPages,\n  //   store.getState().pages\n  // )\n\n  // reporter.info(\n  //   `Deleted ${deletedPages.length} page${deletedPages.length === 1 ? `` : `s`}`\n  // )\n\n  // reporter.info(\n  //   `Found ${changedPages.length} changed page${\n  //     changedPages.length === 1 ? `` : `s`\n  //   }`\n  // )\n  // tim.end()\n\n  activity.end()\n  // return {\n  //   deletedPages,\n  //   changedPages,\n  // }\n}\n"],"file":"source-nodes.js"}