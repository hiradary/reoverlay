"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.createPages = createPages;

var _reporter = _interopRequireDefault(require("gatsby-cli/lib/reporter"));

var _apiRunnerNode = _interopRequireDefault(require("../utils/api-runner-node"));

async function createPages({
  parentSpan,
  gatsbyNodeGraphQLFunction,
  store
}) {
  var _store$getState$nodes, _store$getState$nodes2;

  if (!store) {
    _reporter.default.panic(`store not initialized`);
  }

  const activity = _reporter.default.activityTimer(`createPages`, {
    parentSpan
  });

  activity.start(); // const timestamp = Date.now()
  // const currentPages = new Map<string, IGatsbyPage>(store.getState().pages)

  await (0, _apiRunnerNode.default)(`createPages`, {
    graphql: gatsbyNodeGraphQLFunction,
    traceId: `initial-createPages`,
    waitForCascadingActions: true,
    parentSpan: activity.span
  }, {
    activity
  });

  _reporter.default.verbose(`Now have ${store.getState().nodes.size} nodes with ${store.getState().nodesByType.size} types, and ${(_store$getState$nodes = store.getState().nodesByType) === null || _store$getState$nodes === void 0 ? void 0 : (_store$getState$nodes2 = _store$getState$nodes.get(`SitePage`)) === null || _store$getState$nodes2 === void 0 ? void 0 : _store$getState$nodes2.size} SitePage nodes`);

  activity.end(); // reporter.info(`Checking for deleted pages`)
  // const deletedPages = deleteUntouchedPages(store.getState().pages, timestamp)
  // reporter.info(
  //   `Deleted ${deletedPages.length} page${deletedPages.length === 1 ? `` : `s`}`
  // )
  // const tim = reporter.activityTimer(`Checking for changed pages`)
  // tim.start()
  // const { changedPages } = findChangedPages(
  //   currentPages,
  //   store.getState().pages
  // )
  // reporter.info(
  //   `Found ${changedPages.length} changed page${
  //     changedPages.length === 1 ? `` : `s`
  //   }`
  // )
  // tim.end()
  // return {
  //   changedPages,
  //   deletedPages,
  // }
}
//# sourceMappingURL=create-pages.js.map