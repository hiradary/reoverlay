{"version":3,"file":"index.esm.js","sources":["../../../dist/links/src/AwaitVariablesLink.js","../../../dist/links/src/createServerHttpLink.js","../../../dist/links/src/linkToExecutor.js","../../../dist/links/src/linkToSubscriber.js","../../../dist/links/src/GraphQLUpload.js"],"sourcesContent":["import { ApolloLink, Observable } from 'apollo-link';\nfunction getFinalPromise(object) {\n    return Promise.resolve(object).then(resolvedObject => {\n        if (resolvedObject == null) {\n            return resolvedObject;\n        }\n        if (Array.isArray(resolvedObject)) {\n            return Promise.all(resolvedObject.map(o => getFinalPromise(o)));\n        }\n        else if (typeof resolvedObject === 'object') {\n            const keys = Object.keys(resolvedObject);\n            return Promise.all(keys.map(key => getFinalPromise(resolvedObject[key]))).then(awaitedValues => {\n                for (let i = 0; i < keys.length; i++) {\n                    resolvedObject[keys[i]] = awaitedValues[i];\n                }\n                return resolvedObject;\n            });\n        }\n        return resolvedObject;\n    });\n}\nexport class AwaitVariablesLink extends ApolloLink {\n    request(operation, forward) {\n        return new Observable(observer => {\n            let subscription;\n            getFinalPromise(operation.variables)\n                .then(resolvedVariables => {\n                operation.variables = resolvedVariables;\n                subscription = forward(operation).subscribe({\n                    next: observer.next.bind(observer),\n                    error: observer.error.bind(observer),\n                    complete: observer.complete.bind(observer),\n                });\n            })\n                .catch(observer.error.bind(observer));\n            return () => {\n                if (subscription != null) {\n                    subscription.unsubscribe();\n                }\n            };\n        });\n    }\n}\n//# sourceMappingURL=AwaitVariablesLink.js.map","import { concat } from 'apollo-link';\nimport { createUploadLink, formDataAppendFile, isExtractableFile } from 'apollo-upload-client';\nimport FormData from 'form-data';\nimport { fetch } from 'cross-fetch';\nimport { AwaitVariablesLink } from './AwaitVariablesLink';\nclass FormDataWithStreamSupport extends FormData {\n    constructor(options) {\n        super(options);\n        this.hasUnknowableLength = false;\n    }\n    append(key, value, optionsOrFilename = {}) {\n        // allow filename as single option\n        const options = typeof optionsOrFilename === 'string' ? { filename: optionsOrFilename } : optionsOrFilename;\n        // empty or either doesn't have path or not an http response\n        if (!options.knownLength &&\n            !Buffer.isBuffer(value) &&\n            typeof value !== 'string' &&\n            !value.path &&\n            !(value.readable && 'httpVersion' in value)) {\n            this.hasUnknowableLength = true;\n        }\n        super.append(key, value, options);\n    }\n    getLength(callback) {\n        if (this.hasUnknowableLength) {\n            return null;\n        }\n        return super.getLength(callback);\n    }\n    getLengthSync() {\n        if (this.hasUnknowableLength) {\n            return null;\n        }\n        // eslint-disable-next-line no-sync\n        return super.getLengthSync();\n    }\n}\nexport const createServerHttpLink = (options) => concat(new AwaitVariablesLink(), createUploadLink({\n    ...options,\n    fetch,\n    FormData: FormDataWithStreamSupport,\n    isExtractableFile: (value) => isExtractableFile(value) || (value === null || value === void 0 ? void 0 : value.createReadStream),\n    formDataAppendFile: (form, index, file) => {\n        if (file.createReadStream != null) {\n            form.append(index, file.createReadStream(), {\n                filename: file.filename,\n                contentType: file.mimetype,\n            });\n        }\n        else {\n            formDataAppendFile(form, index, file);\n        }\n    },\n}));\n//# sourceMappingURL=createServerHttpLink.js.map","import { toPromise, execute } from 'apollo-link';\nexport const linkToExecutor = (link) => ({ document, variables, context, info, }) => toPromise(execute(link, {\n    query: document,\n    variables,\n    context: {\n        graphqlContext: context,\n        graphqlResolveInfo: info,\n    },\n}));\n//# sourceMappingURL=linkToExecutor.js.map","import { execute } from 'apollo-link';\nimport { observableToAsyncIterable } from '@graphql-tools/utils';\nexport const linkToSubscriber = (link) => async ({ document, variables, context, info, }) => observableToAsyncIterable(execute(link, {\n    query: document,\n    variables,\n    context: {\n        graphqlContext: context,\n        graphqlResolveInfo: info,\n    },\n}));\n//# sourceMappingURL=linkToSubscriber.js.map","import { GraphQLScalarType, GraphQLError } from 'graphql';\nconst GraphQLUpload = new GraphQLScalarType({\n    name: 'Upload',\n    description: 'The `Upload` scalar type represents a file upload.',\n    parseValue: value => {\n        if (value != null && value.promise instanceof Promise) {\n            // graphql-upload v10\n            return value.promise;\n        }\n        else if (value instanceof Promise) {\n            // graphql-upload v9\n            return value;\n        }\n        throw new GraphQLError('Upload value invalid.');\n    },\n    // serialization requires to support schema stitching\n    serialize: value => value,\n    parseLiteral: ast => {\n        throw new GraphQLError('Upload literal unsupported.', ast);\n    },\n});\nexport { GraphQLUpload };\n//# sourceMappingURL=GraphQLUpload.js.map"],"names":[],"mappings":"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"}