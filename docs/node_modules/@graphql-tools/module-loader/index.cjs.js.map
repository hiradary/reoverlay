{"version":3,"file":"index.cjs.js","sources":["../../../dist/loaders/module/src/index.js"],"sourcesContent":["import { parse, isSchema } from 'graphql';\nimport { fixSchemaAst, printSchemaWithDirectives, } from '@graphql-tools/utils';\nconst InvalidError = new Error(`Imported object was not a string, DocumentNode or GraphQLSchema`);\nconst createLoadError = (error) => new Error('Unable to load schema from module: ' + `${error && error.message ? error.message : error}`);\n// module:node/module#export\nfunction extractData(pointer) {\n    const parts = pointer.replace(/^module\\:/i, '').split('#');\n    if (!parts || parts.length > 2) {\n        throw new Error('Schema pointer should match \"module:path/to/module#export\"');\n    }\n    return {\n        modulePath: parts[0],\n        exportName: parts[1],\n    };\n}\nexport class ModuleLoader {\n    loaderId() {\n        return 'module-loader';\n    }\n    async canLoad(pointer) {\n        return this.canLoadSync(pointer);\n    }\n    canLoadSync(pointer) {\n        return typeof pointer === 'string' && pointer.toLowerCase().startsWith('module:');\n    }\n    async load(pointer, options) {\n        try {\n            const result = this.parse(pointer, options, await this.importModule(pointer));\n            if (result) {\n                return result;\n            }\n            throw InvalidError;\n        }\n        catch (error) {\n            throw createLoadError(error);\n        }\n    }\n    loadSync(pointer, options) {\n        try {\n            const result = this.parse(pointer, options, this.importModuleSync(pointer));\n            if (result) {\n                return result;\n            }\n            throw InvalidError;\n        }\n        catch (error) {\n            throw createLoadError(error);\n        }\n    }\n    parse(pointer, options, importedModule) {\n        if (isSchema(importedModule)) {\n            const schema = fixSchemaAst(importedModule, options);\n            return {\n                schema,\n                get document() {\n                    return parse(printSchemaWithDirectives(schema, options));\n                },\n                location: pointer,\n            };\n        }\n        else if (typeof importedModule === 'string') {\n            return {\n                location: pointer,\n                document: parse(importedModule),\n            };\n        }\n        else if (typeof importedModule === 'object' && importedModule.kind === 'Document') {\n            return {\n                location: pointer,\n                document: importedModule,\n            };\n        }\n    }\n    extractFromModule(mod, modulePath, identifier) {\n        const thing = mod[!identifier || identifier === 'default' ? 'default' : identifier];\n        if (!thing) {\n            throw new Error('Unable to import an object from module: ' + modulePath);\n        }\n        return thing;\n    }\n    // Sync and Async\n    async importModule(pointer) {\n        const { modulePath, exportName } = extractData(pointer);\n        const imported = await import(modulePath);\n        return this.extractFromModule(imported, modulePath, exportName);\n    }\n    async importModuleSync(pointer) {\n        const { modulePath, exportName } = extractData(pointer);\n        const imported = require(modulePath);\n        return this.extractFromModule(imported, modulePath, exportName);\n    }\n}\n//# sourceMappingURL=index.js.map"],"names":["isSchema","fixSchemaAst","parse","printSchemaWithDirectives"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,MAAM,YAAY,GAAG,IAAI,KAAK,CAAC,CAAC,+DAA+D,CAAC,CAAC,CAAC;AAClG,MAAM,eAAe,GAAG,CAAC,KAAK,KAAK,IAAI,KAAK,CAAC,qCAAqC,GAAG,CAAC,EAAE,KAAK,IAAI,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;AAC1I;AACA,SAAS,WAAW,CAAC,OAAO,EAAE;AAC9B,IAAI,MAAM,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AAC/D,IAAI,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;AACpC,QAAQ,MAAM,IAAI,KAAK,CAAC,4DAA4D,CAAC,CAAC;AACtF,KAAK;AACL,IAAI,OAAO;AACX,QAAQ,UAAU,EAAE,KAAK,CAAC,CAAC,CAAC;AAC5B,QAAQ,UAAU,EAAE,KAAK,CAAC,CAAC,CAAC;AAC5B,KAAK,CAAC;AACN,CAAC;AACM,MAAM,YAAY,CAAC;AAC1B,IAAI,QAAQ,GAAG;AACf,QAAQ,OAAO,eAAe,CAAC;AAC/B,KAAK;AACL,IAAI,MAAM,OAAO,CAAC,OAAO,EAAE;AAC3B,QAAQ,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;AACzC,KAAK;AACL,IAAI,WAAW,CAAC,OAAO,EAAE;AACzB,QAAQ,OAAO,OAAO,OAAO,KAAK,QAAQ,IAAI,OAAO,CAAC,WAAW,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;AAC1F,KAAK;AACL,IAAI,MAAM,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE;AACjC,QAAQ,IAAI;AACZ,YAAY,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,OAAO,EAAE,MAAM,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC;AAC1F,YAAY,IAAI,MAAM,EAAE;AACxB,gBAAgB,OAAO,MAAM,CAAC;AAC9B,aAAa;AACb,YAAY,MAAM,YAAY,CAAC;AAC/B,SAAS;AACT,QAAQ,OAAO,KAAK,EAAE;AACtB,YAAY,MAAM,eAAe,CAAC,KAAK,CAAC,CAAC;AACzC,SAAS;AACT,KAAK;AACL,IAAI,QAAQ,CAAC,OAAO,EAAE,OAAO,EAAE;AAC/B,QAAQ,IAAI;AACZ,YAAY,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,OAAO,EAAE,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC;AACxF,YAAY,IAAI,MAAM,EAAE;AACxB,gBAAgB,OAAO,MAAM,CAAC;AAC9B,aAAa;AACb,YAAY,MAAM,YAAY,CAAC;AAC/B,SAAS;AACT,QAAQ,OAAO,KAAK,EAAE;AACtB,YAAY,MAAM,eAAe,CAAC,KAAK,CAAC,CAAC;AACzC,SAAS;AACT,KAAK;AACL,IAAI,KAAK,CAAC,OAAO,EAAE,OAAO,EAAE,cAAc,EAAE;AAC5C,QAAQ,IAAIA,gBAAQ,CAAC,cAAc,CAAC,EAAE;AACtC,YAAY,MAAM,MAAM,GAAGC,kBAAY,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;AACjE,YAAY,OAAO;AACnB,gBAAgB,MAAM;AACtB,gBAAgB,IAAI,QAAQ,GAAG;AAC/B,oBAAoB,OAAOC,aAAK,CAACC,+BAAyB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC;AAC7E,iBAAiB;AACjB,gBAAgB,QAAQ,EAAE,OAAO;AACjC,aAAa,CAAC;AACd,SAAS;AACT,aAAa,IAAI,OAAO,cAAc,KAAK,QAAQ,EAAE;AACrD,YAAY,OAAO;AACnB,gBAAgB,QAAQ,EAAE,OAAO;AACjC,gBAAgB,QAAQ,EAAED,aAAK,CAAC,cAAc,CAAC;AAC/C,aAAa,CAAC;AACd,SAAS;AACT,aAAa,IAAI,OAAO,cAAc,KAAK,QAAQ,IAAI,cAAc,CAAC,IAAI,KAAK,UAAU,EAAE;AAC3F,YAAY,OAAO;AACnB,gBAAgB,QAAQ,EAAE,OAAO;AACjC,gBAAgB,QAAQ,EAAE,cAAc;AACxC,aAAa,CAAC;AACd,SAAS;AACT,KAAK;AACL,IAAI,iBAAiB,CAAC,GAAG,EAAE,UAAU,EAAE,UAAU,EAAE;AACnD,QAAQ,MAAM,KAAK,GAAG,GAAG,CAAC,CAAC,UAAU,IAAI,UAAU,KAAK,SAAS,GAAG,SAAS,GAAG,UAAU,CAAC,CAAC;AAC5F,QAAQ,IAAI,CAAC,KAAK,EAAE;AACpB,YAAY,MAAM,IAAI,KAAK,CAAC,0CAA0C,GAAG,UAAU,CAAC,CAAC;AACrF,SAAS;AACT,QAAQ,OAAO,KAAK,CAAC;AACrB,KAAK;AACL;AACA,IAAI,MAAM,YAAY,CAAC,OAAO,EAAE;AAChC,QAAQ,MAAM,EAAE,UAAU,EAAE,UAAU,EAAE,GAAG,WAAW,CAAC,OAAO,CAAC,CAAC;AAChE,QAAQ,MAAM,QAAQ,GAAG,MAAM,mEAAO,UAAU,OAAC,CAAC;AAClD,QAAQ,OAAO,IAAI,CAAC,iBAAiB,CAAC,QAAQ,EAAE,UAAU,EAAE,UAAU,CAAC,CAAC;AACxE,KAAK;AACL,IAAI,MAAM,gBAAgB,CAAC,OAAO,EAAE;AACpC,QAAQ,MAAM,EAAE,UAAU,EAAE,UAAU,EAAE,GAAG,WAAW,CAAC,OAAO,CAAC,CAAC;AAChE,QAAQ,MAAM,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAC7C,QAAQ,OAAO,IAAI,CAAC,iBAAiB,CAAC,QAAQ,EAAE,UAAU,EAAE,UAAU,CAAC,CAAC;AACxE,KAAK;AACL;;;;"}