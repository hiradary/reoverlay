{"version":3,"file":"index.cjs.js","sources":["../../../dist/loaders/git/src/load-git.js","../../../dist/loaders/git/src/parse.js","../../../dist/loaders/git/src/index.js"],"sourcesContent":["import simplegit from 'simple-git/promise';\nimport simplegitSync from 'simple-git';\nconst createLoadError = (error) => new Error('Unable to load schema from git: ' + error);\nconst createCommand = ({ ref, path }) => {\n    return [`${ref}:${path}`];\n};\nexport async function loadFromGit(input) {\n    try {\n        const git = simplegit();\n        return await git.show(createCommand(input));\n    }\n    catch (error) {\n        throw createLoadError(error);\n    }\n}\nexport function loadFromGitSync(input) {\n    try {\n        const git = simplegitSync();\n        return git.show(createCommand(input));\n    }\n    catch (error) {\n        throw createLoadError(error);\n    }\n}\n//# sourceMappingURL=load-git.js.map","import { parseGraphQLSDL, parseGraphQLJSON } from '@graphql-tools/utils';\nexport function parse({ path, pointer, content, options, }) {\n    if (/\\.(gql|graphql)s?$/i.test(path)) {\n        return parseGraphQLSDL(pointer, content, options);\n    }\n    if (/\\.json$/i.test(path)) {\n        return parseGraphQLJSON(pointer, content, options);\n    }\n}\n//# sourceMappingURL=parse.js.map","import { gqlPluckFromCodeString, gqlPluckFromCodeStringSync, } from '@graphql-tools/graphql-tag-pluck';\nimport { loadFromGit, loadFromGitSync } from './load-git';\nimport { parse } from './parse';\n// git:branch:path/to/file\nfunction extractData(pointer) {\n    const parts = pointer.replace(/^git\\:/i, '').split(':');\n    if (!parts || parts.length !== 2) {\n        throw new Error('Schema pointer should match \"git:branchName:path/to/file\"');\n    }\n    return {\n        ref: parts[0],\n        path: parts[1],\n    };\n}\nconst createInvalidExtensionError = (path) => new Error(`Invalid file extension: ${path}`);\nexport class GitLoader {\n    loaderId() {\n        return 'git-loader';\n    }\n    async canLoad(pointer) {\n        return this.canLoadSync(pointer);\n    }\n    canLoadSync(pointer) {\n        return typeof pointer === 'string' && pointer.toLowerCase().startsWith('git:');\n    }\n    async load(pointer, options) {\n        const { ref, path } = extractData(pointer);\n        const content = await loadFromGit({ ref, path });\n        const parsed = parse({ path, options, pointer, content });\n        if (parsed) {\n            return parsed;\n        }\n        const rawSDL = await gqlPluckFromCodeString(pointer, content, options.pluckConfig);\n        return ensureSource({ rawSDL, pointer, path });\n    }\n    loadSync(pointer, options) {\n        const { ref, path } = extractData(pointer);\n        const content = loadFromGitSync({ ref, path });\n        const parsed = parse({ path, options, pointer, content });\n        if (parsed) {\n            return parsed;\n        }\n        const rawSDL = gqlPluckFromCodeStringSync(pointer, content, options.pluckConfig);\n        return ensureSource({ rawSDL, pointer, path });\n    }\n}\nfunction ensureSource({ rawSDL, pointer, path }) {\n    if (rawSDL) {\n        return {\n            location: pointer,\n            rawSDL,\n        };\n    }\n    throw createInvalidExtensionError(path);\n}\n//# sourceMappingURL=index.js.map"],"names":["parseGraphQLSDL","parseGraphQLJSON","gqlPluckFromCodeString","gqlPluckFromCodeStringSync"],"mappings":"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"}