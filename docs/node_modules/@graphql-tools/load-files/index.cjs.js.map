{"version":3,"file":"index.cjs.js","sources":["../../../dist/load-files/src/index.js"],"sourcesContent":["import globby, { sync as globbySync } from 'globby';\nimport unixify from 'unixify';\nimport { extname } from 'path';\nimport { readFile, stat, statSync, readFileSync } from 'fs-extra';\nconst DEFAULT_IGNORED_EXTENSIONS = ['spec', 'test', 'd', 'map'];\nconst DEFAULT_EXTENSIONS = ['gql', 'graphql', 'graphqls', 'ts', 'js'];\nconst DEFAULT_EXPORT_NAMES = ['typeDefs', 'schema'];\nfunction asArray(obj) {\n    if (obj instanceof Array) {\n        return obj;\n    }\n    else {\n        return [obj];\n    }\n}\nfunction isDirectorySync(path) {\n    try {\n        const pathStat = statSync(path);\n        return pathStat.isDirectory();\n    }\n    catch (e) {\n        return false;\n    }\n}\nasync function isDirectory(path) {\n    try {\n        const pathStat = await stat(path);\n        return pathStat.isDirectory();\n    }\n    catch (e) {\n        return false;\n    }\n}\nfunction scanForFilesSync(globStr, globOptions = {}) {\n    return globbySync(globStr, { absolute: true, ...globOptions });\n}\nfunction buildGlob(basePath, extensions, ignoredExtensions = [], recursive) {\n    const ignored = ignoredExtensions.length > 0 ? `!(${ignoredExtensions.map(e => '*.' + e).join('|')})` : '*';\n    const ext = extensions.map(e => '*.' + e).join('|');\n    return `${basePath}${recursive ? '/**' : ''}/${ignored}+(${ext})`;\n}\nfunction extractExports(fileExport, exportNames) {\n    if (!fileExport) {\n        return null;\n    }\n    if (fileExport.default) {\n        for (const exportName of exportNames) {\n            if (fileExport.default[exportName]) {\n                return fileExport.default[exportName];\n            }\n        }\n        return fileExport.default;\n    }\n    for (const exportName of exportNames) {\n        if (fileExport[exportName]) {\n            return fileExport[exportName];\n        }\n    }\n    return fileExport;\n}\nconst LoadFilesDefaultOptions = {\n    ignoredExtensions: DEFAULT_IGNORED_EXTENSIONS,\n    extensions: DEFAULT_EXTENSIONS,\n    useRequire: false,\n    requireMethod: null,\n    globOptions: {\n        absolute: true,\n    },\n    exportNames: DEFAULT_EXPORT_NAMES,\n    recursive: true,\n    ignoreIndex: false,\n};\nexport function loadFilesSync(pattern, options = LoadFilesDefaultOptions) {\n    const execOptions = { ...LoadFilesDefaultOptions, ...options };\n    const relevantPaths = scanForFilesSync(asArray(pattern).map(path => isDirectorySync(path)\n        ? buildGlob(unixify(path), execOptions.extensions, execOptions.ignoredExtensions, execOptions.recursive)\n        : unixify(path)), options.globOptions);\n    return relevantPaths\n        .map(path => {\n        if (!checkExtension(path, options)) {\n            return;\n        }\n        if (isIndex(path, execOptions.extensions) && options.ignoreIndex) {\n            return false;\n        }\n        const extension = extname(path);\n        if (extension.endsWith('.js') || extension.endsWith('.ts') || execOptions.useRequire) {\n            const fileExports = (execOptions.requireMethod ? execOptions.requireMethod : require)(path);\n            const extractedExport = extractExports(fileExports, execOptions.exportNames);\n            if (extractedExport.typeDefs && extractedExport.resolvers) {\n                return extractedExport;\n            }\n            if (extractedExport.schema) {\n                return extractedExport.schema;\n            }\n            if (extractedExport.typeDef) {\n                return extractedExport.typeDef;\n            }\n            if (extractedExport.typeDefs) {\n                return extractedExport.typeDefs;\n            }\n            if (extractedExport.resolver) {\n                return extractedExport.resolver;\n            }\n            if (extractedExport.resolvers) {\n                return extractedExport.resolvers;\n            }\n            return extractedExport;\n        }\n        else {\n            return readFileSync(path, { encoding: 'utf-8' });\n        }\n    })\n        .filter(v => v);\n}\nasync function scanForFiles(globStr, globOptions = {}) {\n    return globby(globStr, { absolute: true, ...globOptions });\n}\nconst checkExtension = (path, { extensions, ignoredExtensions }) => {\n    if (ignoredExtensions) {\n        for (const ignoredExtension of ignoredExtensions) {\n            if (path.endsWith(ignoredExtension)) {\n                return false;\n            }\n        }\n    }\n    if (!extensions) {\n        return true;\n    }\n    for (const extension of extensions) {\n        if (path.endsWith(extension)) {\n            return true;\n        }\n    }\n    return false;\n};\nexport async function loadFiles(pattern, options = LoadFilesDefaultOptions) {\n    const execOptions = { ...LoadFilesDefaultOptions, ...options };\n    const relevantPaths = await scanForFiles(await Promise.all(asArray(pattern).map(async (path) => (await isDirectory(path))\n        ? buildGlob(unixify(path), execOptions.extensions, execOptions.ignoredExtensions, execOptions.recursive)\n        : unixify(path))), options.globOptions);\n    const require$ = (path) => import(path).catch(async () => require(path));\n    return Promise.all(relevantPaths\n        .filter(path => checkExtension(path, options) && !(isIndex(path, execOptions.extensions) && options.ignoreIndex))\n        .map(async (path) => {\n        const extension = extname(path);\n        if (extension.endsWith('.js') || extension.endsWith('.ts') || execOptions.useRequire) {\n            const fileExports = await (execOptions.requireMethod ? execOptions.requireMethod : require$)(path);\n            const extractedExport = extractExports(fileExports, execOptions.exportNames);\n            if (extractedExport.resolver) {\n                return extractedExport.resolver;\n            }\n            if (extractedExport.resolvers) {\n                return extractedExport.resolvers;\n            }\n            return extractedExport;\n        }\n        else {\n            return readFile(path, { encoding: 'utf-8' });\n        }\n    }));\n}\nfunction isIndex(path, extensions = []) {\n    const IS_INDEX = /(\\/|\\\\)index\\.[^\\/\\\\]+$/i; // (/ or \\) AND `index.` AND (everything except \\ and /)(end of line)\n    return IS_INDEX.test(path) && extensions.some(ext => path.endsWith('.' + ext));\n}\n//# sourceMappingURL=index.js.map"],"names":["statSync","stat","globbySync","path","extname","readFileSync","globby","readFile"],"mappings":"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"}