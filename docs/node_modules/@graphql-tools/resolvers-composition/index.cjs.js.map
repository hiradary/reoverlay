{"version":3,"file":"index.cjs.js","sources":["../../../dist/resolvers-composition/src/chain-functions.js","../../../dist/resolvers-composition/src/resolvers-composition.js"],"sourcesContent":["export function chainFunctions(funcs) {\n    if (funcs.length === 1) {\n        return funcs[0];\n    }\n    return funcs.reduce((a, b) => (...args) => a(b(...args)));\n}\n//# sourceMappingURL=chain-functions.js.map","import { chainFunctions } from './chain-functions';\nimport { get, set, flatten } from 'lodash';\nimport { isScalarType } from 'graphql';\nimport { asArray } from '@graphql-tools/utils';\nfunction resolveRelevantMappings(resolvers, path, allMappings) {\n    const splitted = path.split('.');\n    if (splitted.length === 2) {\n        const typeName = splitted[0];\n        if (isScalarType(resolvers[typeName])) {\n            return [];\n        }\n        const fieldName = splitted[1];\n        if (typeName === '*') {\n            return flatten(Object.keys(resolvers).map(typeName => resolveRelevantMappings(resolvers, `${typeName}.${fieldName}`, allMappings)));\n        }\n        if (fieldName === '*') {\n            return flatten(Object.keys(resolvers[typeName]).map(field => resolveRelevantMappings(resolvers, `${typeName}.${field}`, allMappings))).filter(mapItem => !allMappings[mapItem]);\n        }\n        else {\n            const paths = [];\n            if (resolvers[typeName] && resolvers[typeName][fieldName]) {\n                if (resolvers[typeName][fieldName].subscribe) {\n                    paths.push(path + '.subscribe');\n                }\n                if (resolvers[typeName][fieldName].resolve) {\n                    paths.push(path + '.resolve');\n                }\n                if (typeof resolvers[typeName][fieldName] === 'function') {\n                    paths.push(path);\n                }\n            }\n            return paths;\n        }\n    }\n    else if (splitted.length === 1) {\n        const typeName = splitted[0];\n        return flatten(Object.keys(resolvers[typeName]).map(fieldName => resolveRelevantMappings(resolvers, `${typeName}.${fieldName}`, allMappings)));\n    }\n    return [];\n}\n/**\n * Wraps the resolvers object with the resolvers composition objects.\n * Implemented as a simple and basic middleware mechanism.\n *\n * @param resolvers - resolvers object\n * @param mapping - resolvers composition mapping\n * @hidden\n */\nexport function composeResolvers(resolvers, mapping = {}) {\n    const mappingResult = {};\n    Object.keys(mapping).map((resolverPath) => {\n        if (mapping[resolverPath] instanceof Array || typeof mapping[resolverPath] === 'function') {\n            const composeFns = mapping[resolverPath];\n            const relevantFields = resolveRelevantMappings(resolvers, resolverPath, mapping);\n            relevantFields.forEach((path) => {\n                mappingResult[path] = asArray(composeFns);\n            });\n        }\n        else {\n            Object.keys(mapping[resolverPath]).forEach(fieldName => {\n                const composeFns = mapping[resolverPath][fieldName];\n                const relevantFields = resolveRelevantMappings(resolvers, resolverPath + '.' + fieldName, mapping);\n                relevantFields.forEach((path) => {\n                    mappingResult[path] = asArray(composeFns);\n                });\n            });\n        }\n    });\n    Object.keys(mappingResult).forEach(path => {\n        const fns = chainFunctions([...asArray(mappingResult[path]), () => get(resolvers, path)]);\n        set(resolvers, path, fns());\n    });\n    return resolvers;\n}\n//# sourceMappingURL=resolvers-composition.js.map"],"names":["isScalarType","flatten","asArray","get","set"],"mappings":"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"}